
# Environment Setup

## Requirements & tools:

- IDE (Visual Studio Code / VS Codium)
    - Windows:
        ```bash
        winget install -e --id Microsoft.VisualStudioCode
        # or
        winget install -e --id VSCodium.VSCodium
        ```

- WSL2
    - Windows: `wsl --install --web-download`
    - Restart the machine

- Container Runtime (Docker Desktop / Orbstack / Podman)
    - Windows: `winget install -e --id Docker.DockerDesktop`
    - Start Docker Desktop & Use WSL2 Backend
    - Skip Login and Survey

- Kubernetes tools:
    - `kind` - local kubernetes distribution
        - https://github.com/kubernetes-sigs/kind/releases
        - Windows: `winget install -e --id Kubernetes.kind`

    - `kubectl` - kubernetes CLI
        - https://kubernetes.io/docs/tasks/tools/#kubectl
        - Windows: `winget install -e --id Kubernetes.kubectl`

    - `k9s` - kubernetes terminal UI
        - https://github.com/derailed/k9s/releases
        - Windows: `choco install k9s`

    - `helm` - kubernetes package manger
        - https://github.com/helm/helm/releases
        - Windows: `winget install Helm.helm`

## Kubernetes Cluster & Demo App with Ingress

  - Create `kind.argocd.yaml`
    ```yaml
    kind: Cluster
    apiVersion: kind.x-k8s.io/v1alpha4
    name: argocd
    nodes:
    - role: control-plane
      extraPortMappings:
      - containerPort: 80
        hostPort: 80
      - containerPort: 443
        hostPort: 443
    ```

- Create `kind` cluster & verify `kubectl`, `helm` and `k9s`
    ```bash
    kind create cluster --config kind.argocd.yaml
    kubectl cluster-info --context kind-argocd
    kubectl get pods -A
    helm list -A
    k9s
    ```

- Deploy Ingress Controller
    ```bash
    kubectl --context kind-argocd apply -f https://kind.sigs.k8s.io/examples/ingress/deploy-ingress-nginx.yaml
    kubectl --context kind-argocd apply -f https://kind.sigs.k8s.io/examples/ingress/deploy-ingress-nginx.yaml --context kind-development

    kubectl --context kind-argocd wait --namespace ingress-nginx --for=condition=ready pod --selector=app.kubernetes.io/component=controller --timeout=90s
    ```

- Deploy demo app "podinfo" and verify by opening http://podinfo.kind

    Add `127.0.0.1 podinfo.kind` to `C:\Windows\System32\drivers\etc\hosts`

    ```bash
    helm upgrade --install --namespace podinfo --create-namespace podinfo oci://ghcr.io/stefanprodan/charts/podinfo --set 'ingress.enabled=true' --set 'ingress.hosts[0].host=podinfo.kind,ingress.hosts[0].paths[0].path=/,ingress.hosts[0].paths[0].pathType=ImplementationSpecific'
    ```

## Setup Gitea & git client

- Add `127.0.0.1 gitea.kind` to `C:\Windows\System32\drivers\etc\hosts`

- Deploy local `gitea` and verify by opening http://gitea.kind

    ```bash
    helm upgrade --install --namespace gitea --create-namespace gitea oci://docker.gitea.com/charts/gitea --set 'ingress.enabled=true' --set 'ingress.hosts[0].host=gitea.kind,ingress.hosts[0].paths[0].path=/,ingress.hosts[0].paths[0].pathType=ImplementationSpecific'
    ```

-   Gitea
    - Create a new account
    - Create a new **private** repository `course-argocd` and check the box "Initialize Repository"

- Git Client
    - https://git-scm.com/downloads
    - Windows: `winget install -e --id Git.Git`
    - Configure git client
        ```bash
        git config --global user.name "Sergei Waigant"
        git config --global user.email "sergei@waigant.com"
        git config --global -l
        ```
    - Clone repository, add a file, commit and push
        ```bash
        git clone http://gitea.kind/sergeiwaigant/course-argocd
        cd course-argocd
        touch testfile
        git status
        git add testfile
        git commit -m "adding testfile"
        git push
        ```
